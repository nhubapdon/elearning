<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>B√†i vi·∫øt ch·ªù ki·ªÉm duy·ªát</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(180deg, #0f172a, #1e293b, #111827);
      color: #e2e8f0;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }

    .page-title {
      font-size: 42px;
      font-weight: 800;
      text-align: center;
      padding: 50px 0 25px;
      color: #f8fafc;
      letter-spacing: 1px;
    }

    .pending-container {
      width: 90%;
      margin: auto;
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 4px 40px rgba(0, 0, 0, 0.45);
    }

    table {
      color: #f1f5f9;
    }

    thead {
      background: rgba(255, 255, 255, 0.12);
      color: #e2e8f0;
    }

    tbody tr {
      background: rgba(255, 255, 255, 0.15);
      transition: 0.25s;
    }

    tbody tr:hover {
      background: rgba(255, 255, 255, 0.22);
      transform: scale(1.01);
    }

    td {
      vertical-align: middle;
    }

    .post-thumb {
      width: 85px;
      height: 85px;
      object-fit: cover;
      border-radius: 10px;
      border: 2px solid rgba(255, 255, 255, 0.18);
    }

    .btn-approve {
      background: #10b981;
      border: none;
      padding: 6px 15px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn-approve:hover {
      background: #0f946b;
      transform: scale(1.05);
    }

    .btn-reject {
      background: #ef4444;
      border: none;
      padding: 6px 15px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn-reject:hover {
      background: #c53030;
      transform: scale(1.05);
    }

    /* n√∫t quay l·∫°i */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      background: #38bdf8;
      color: #0f172a;
      border-radius: 10px;
      font-weight: 600;
      margin-bottom: 20px;
      text-decoration: none;
      transition: 0.25s;
    }
    .back-btn:hover {
      background: #0ea5e9;
      transform: translateY(-2px);
      color: #0f172a;
    }

  </style>
</head>
<body>

  <h1 class="page-title">B√†i vi·∫øt ch·ªù ki·ªÉm duy·ªát</h1>

  <div class="pending-container">

    <!-- üîô N√∫t quay l·∫°i di·ªÖn ƒë√†n -->
    <a href="/blog" class="back-btn">
      ‚¨Ö Quay l·∫°i di·ªÖn ƒë√†n h·ªçc t·∫≠p
    </a>

    <% if (posts.length === 0) { %>
      <h4 class="text-center mt-4" style="color:#cbd5e1;">Kh√¥ng c√≥ b√†i vi·∫øt n√†o ƒëang ch·ªù duy·ªát.</h4>
    <% } else { %>

    <table class="table table-bordered align-middle text-center">
      <thead>
        <tr>
          <th>·∫¢nh</th>
          <th>Ti√™u ƒë·ªÅ</th>
          <th>T√°c gi·∫£</th>
          <th>N·ªôi dung</th>
          <th>Th·ªùi gian</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>

      <tbody>
        <% posts.forEach(post => { %>
          <tr>
            <td>
              <img src="<%= post.thumbnail || '/assets/images/placeholder.jpg' %>" class="post-thumb">
            </td>

            <td style="font-weight:600;"><%= post.title.substring(0, 40) %>...</td>

            <td>
              <img src="<%= post.author_avatar || '/assets/images/default-avatar.png' %>"
                   width="40" height="40"
                   style="border-radius:50%; object-fit:cover;">
              <br>
              <%= post.author_name %>
            </td>

            <td style="text-align:left; max-width:300px;">
              <%= post.content.substring(0, 100) %>...
            </td>

            <td><%= new Date(post.created_at).toLocaleString("vi-VN") %></td>

            <td>
<button class="btn-approve" data-id="<%= post.id %>">‚úî Duy·ªát</button>
<button class="btn-reject" data-id="<%= post.id %>">‚úñ T·ª´ ch·ªëi</button>

            </td>
          </tr>
        <% }) %>
      </tbody>

    </table>

    <% } %>

  </div>

<script>
document.addEventListener("click", async (e) => {
  // DUY·ªÜT B√ÄI
  if (e.target.closest(".btn-approve")) {
    const btn = e.target.closest(".btn-approve");
    const id = btn.dataset.id;

    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën DUY·ªÜT b√†i vi·∫øt n√†y?")) return;

    const res = await fetch(`/blog/admin/approve/${id}`, { method: "PUT" });
    const data = await res.json();

    if (data.success) {
      alert("‚úî B√†i vi·∫øt ƒë√£ ƒë∆∞·ª£c duy·ªát!");
      btn.closest("tr").remove();
    } else {
      alert("L·ªói duy·ªát b√†i.");
    }
  }

  // T·ª™ CH·ªêI B√ÄI
  if (e.target.closest(".btn-reject")) {
    const btn = e.target.closest(".btn-reject");
    const id = btn.dataset.id;

    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën T·ª™ CH·ªêI v√† XO√Å b√†i n√†y?")) return;

    const res = await fetch(`/blog/admin/reject/${id}`, { method: "DELETE" });
    const data = await res.json();

    if (data.success) {
      alert("‚úñ ƒê√£ xo√° b√†i vi·∫øt!");
      btn.closest("tr").remove();
    } else {
      alert("L·ªói xo√° b√†i.");
    }
  }
});
</script>


</body>
</html>
