<%- include("../partials/header") %>

  <div class="page-wrapper overflow-hidden">
    <!-- Banner -->
    <section class="banner-section banner-inner-section position-relative overflow-hidden d-flex align-items-end"
      style="background-image: url(../assets/images/backgrounds/banner-course.jpg); background-size: cover; background-position: center;">
      <div class="container">
        <div class="d-flex flex-column gap-4 pb-5 pb-xl-10 position-relative z-1">
          <div class="row align-items-center">
            <div class="col-xl-6">
              <div class="d-flex align-items-center gap-4">
                <img src="../assets/images/svgs/primary-leaf.svg" alt="" class="img-fluid animate-spin">
                <p class="mb-0 text-white fs-5 text-opacity-70">
                  <span class="text-primary">Kh√°m ph√° tri th·ª©c</span> qua h√†ng trƒÉm kh√≥a h·ªçc ch·∫•t l∆∞·ª£ng ƒë∆∞·ª£c bi√™n so·∫°n
                  b·ªüi c√°c gi·∫£ng vi√™n h√†ng ƒë·∫ßu.
                </p>
              </div>
            </div>
          </div>
          <div class="d-flex align-items-end gap-3" data-aos="fade-up" data-aos-delay="200" data-aos-duration="1000">
            <h1 class="mb-0 fs-16 text-white lh-1">Kh√≥a h·ªçc</h1>
            <a href="javascript:void(0)" class="p-1 ps-7 bg-primary rounded-pill">
              <span class="bg-white round-52 rounded-circle d-flex align-items-center justify-content-center">
                <iconify-icon icon="lucide:arrow-up-right" class="fs-8 text-dark"></iconify-icon>
              </span>
            </a>
          </div>
        </div>
      </div>
  </div>
  </section>

  <!-- Courses Section -->
  <section id="courses" class="courses-section py-5">
    <div class="container">
    
      <!-- üîç B·ªô l·ªçc & T√¨m ki·∫øm hi·ªán ƒë·∫°i -->
      <div
        class="filter-bar container mb-5 mt-4 px-3 py-3 rounded-4 shadow-sm bg-white d-flex flex-wrap justify-content-between align-items-center gap-3">

        <!-- B·ªô l·ªçc danh m·ª•c -->
        <div class="filter-tags d-flex flex-wrap gap-3">
          <button class="filter-btn active" data-category="all">
            <i class="bi bi-grid-fill me-1"></i> T·∫•t c·∫£
          </button>
          <button class="filter-btn" data-category="C√¥ng ngh·ªá th√¥ng tin">
            <i class="bi bi-cpu me-1"></i> C√¥ng ngh·ªá
          </button>
          <button class="filter-btn" data-category="K·ªπ nƒÉng m·ªÅm">
            <i class="bi bi-chat-dots-fill me-1"></i> K·ªπ nƒÉng m·ªÅm
          </button>
          <button class="filter-btn" data-category="Khoa h·ªçc & K·ªπ thu·∫≠t">
            <i class="bi bi-bezier2 me-1"></i> Khoa h·ªçc - K·ªπ thu·∫≠t
          </button>
        </div>

        <!-- √î t√¨m ki·∫øm -->
        <div class="search-box position-relative">
          <i class="bi bi-search position-absolute top-50 start-3 translate-middle-y text-secondary"></i>
          <input type="text" id="searchInput" class="form-control ps-5 py-2 rounded-pill shadow-sm"
            placeholder=" T√¨m ki·∫øm kh√≥a h·ªçc theo ti√™u ƒë·ªÅ...">
        </div>
      </div>


      <!-- Danh s√°ch kh√≥a h·ªçc -->
      <div class="row g-4 justify-content-center" id="courseList">
        <% if (courses.length===0) { %>
          <p class="text-center text-muted">Hi·ªán ch∆∞a c√≥ kh√≥a h·ªçc n√†o.</p>
          <% } else { %>
            <% courses.forEach(course=> { %>
              <div class="col-xl-4 col-lg-4 col-md-6 mb-5 course-item" data-category="<%= (course.categories || []).join(', ') %>"
                data-title="<%= (course.title || '').toLowerCase() %>">

<%
  // --- Chu·∫©n h√≥a d·ªØ li·ªáu ---
  var price = Number(course.price) || 0;
  var rating = Number(course.rating) || 0;
  var totalClasses = Number(course.total_classes) || 0;
  var totalStudents = Number(course.total_students) || 0;

  // --- Badge logic ---
  var createdAt = new Date(course.created_at ? course.created_at : (course.createdAt ? course.createdAt : Date.now()));
  var now = new Date();
  var diffDays = Math.floor((now - createdAt) / (1000 * 60 * 60 * 24));
  var hasRating = (rating > 0);
  var showNew = (!hasRating && diffDays <= 5);
  var showHot = (hasRating && rating >= 4.2);

  // --- Sao fill theo ph·∫ßn trƒÉm ---
  var percent = Math.max(0, Math.min(100, (rating / 5) * 100));
%>




                    <div class="ai-card">
                      <!-- Animated gradient border -->
                      <span class="ai-card__border"></span>

                      <!-- Image + badge -->
<div class="ai-card__image">
  <a href="/courses/<%= course.id %>">
    <img src="<%= course.thumbnail || '/assets/images/default-course.jpg' %>"
      alt="<%= course.title %>">
  </a>

  <% if (showNew) { %>
    <span class="ai-badge ai-badge--new">M·ªöI</span>
  <% } else if (showHot) { %>
    <span class="ai-badge ai-badge--hot">HOT</span>
  <% } %>
</div>

<!-- Content -->
<div class="ai-card__content">
  <h4 class="ai-card__title" title="<%= course.title %>">
    <a href="/courses/<%= course.id %>" class="course-title-link">
      <%= course.title %>
    </a>
  </h4>
                        <p class="ai-card__desc">
                          <%= (course.description || '' ).substring(0, 90) %>...
                        </p>
                        <div class="course-tags mb-2">
  <% if (course.categories && course.categories.length > 0) { %>
    <% course.categories.forEach(cat => { %>
      <%
  // G√°n m√†u d·ª±a tr√™n t√™n danh m·ª•c
  let color = "blue";
  if (cat.toLowerCase().includes("marketing") || cat.toLowerCase().includes("kinh doanh")) color = "orange";
  else if (cat.toLowerCase().includes("k·ªπ nƒÉng") || cat.toLowerCase().includes("k·ªπ nƒÉng m·ªÅm")) color = "purple";
  else if (cat.toLowerCase().includes("thi·∫øt k·∫ø") || cat.toLowerCase().includes("ui") || cat.toLowerCase().includes("figma")) color = "teal";
%>
<a href="/courses?category=<%= encodeURIComponent(cat) %>" class="tag-chip ripple" data-color="<%= color %>">
  <%= cat %>
</a>

    <% }) %>
  <% } else { %>
    <span class="tag-chip tag-empty">Ch∆∞a c√≥ danh m·ª•c</span>
  <% } %>
</div>


                        <div class="ai-card__meta">
                          <span class="meta">
                            <!-- icon l·ªõp -->
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                              <path d="M4 7l8-4 8 4-8 4-8-4z" stroke="#00C2FF" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                              <path d="M4 12l8 4 8-4" stroke="#00C2FF" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                              <path d="M4 17l8 4 8-4" stroke="#00C2FF" stroke-width="1.6" stroke-linecap="round"
                                stroke-linejoin="round" />
                            </svg>
                            <%= totalClasses %> l·ªõp
                          </span>

                          <span class="meta">
                            <!-- icon h·ªçc vi√™n -->
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                              <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="#00C2FF" stroke-width="1.6"
                                stroke-linecap="round" />
                              <circle cx="10" cy="7" r="3.5" stroke="#00C2FF" stroke-width="1.6" />
                            </svg>
                            <%= totalStudents %> h·ªçc vi√™n
                          </span>
                        </div>

                        <div class="ai-card__footer">
                          <!-- Sao fill theo % -->
                          <div class="rating-stars" style="--percent:<%= percent %>%;">
                            <span class="rating-number">
                              <%= (hasRating ? rating : 0).toFixed(1) %>
                            </span>
                          </div>

                          <p class="price">
                            <%= price.toLocaleString() %> ‚Ç´
                          </p>
                        </div>

                        <div class="ai-card__actions d-flex justify-content-between align-items-center gap-2 mt-3">
    <a href="/courses/<%= course.id %>" class="btn-ai flex-grow-1">
        ƒêƒÉng k√Ω ngay
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M5 12h14M13 5l7 7-7 7" stroke="#fff" stroke-width="1.8" stroke-linecap="round"
            stroke-linejoin="round"/>
        </svg>
    </a>

    <button
      type="button"
      class="btn-ai-cart btn-add-cart"
      data-course-id="<%= course.id %>">
      <i class="bi bi-cart-plus"></i>
    </button>
</div>

                      </div>
                    </div>
              </div>



              <% }) %>
                <% } %>
      </div>
    </div>
  </section>
  <!-- PAGINATION -->
<div class="pagination-wrapper">
  <% if (pagination.totalPages > 1) { %>
    <ul class="pagination">
      
      <% if (pagination.page > 1) { %>
        <li><a href="?page=<%= pagination.page - 1 %>">Prev</a></li>
      <% } %>

      <% for (let i = 1; i <= pagination.totalPages; i++) { %>
        <li class="<%= i === pagination.page ? 'active' : '' %>">
          <a href="?page=<%= i %>"><%= i %></a>
        </li>
      <% } %>

      <% if (pagination.page < pagination.totalPages) { %>
        <li><a href="?page=<%= pagination.page + 1 %>">Next</a></li>
      <% } %>

    </ul>
  <% } %>
</div>

  </div>
  <div id="cartToast" class="cart-toast">
  <i class="bi bi-check-circle-fill me-2"></i>
  <span id="cartToastMessage">ƒê√£ th√™m kh√≥a h·ªçc v√†o gi·ªè h√†ng</span>
</div>

<script src="/assets/js/course.js"></script>

  <%- include("../partials/footer") %>