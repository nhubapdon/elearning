<%- include("../partials/db-header") %>
<link rel="stylesheet" href="/assets/css/admin-quizzes.css">
<link rel="stylesheet" href="/assets/css/course-students.css">
<main class="dash-main modern-ui main-offset">

  <!-- TITLE -->
  <h1 class="page-title">Qu·∫£n l√Ω h·ªçc vi√™n</h1>
  <p class="page-sub">Kh√≥a h·ªçc: <b><%= course.title %></b> ‚Äî ID #<%= courseId %></p>

  <!-- META SUMMARY -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3>B√†i h·ªçc</h3>
      <div class="stat-value"><%= meta.total_lessons %></div>
      <div class="stat-desc">T·ªïng s·ªë b√†i h·ªçc</div>
    </div>

    <div class="stat-card">
      <h3>B√†i t·∫≠p</h3>
      <div class="stat-value"><%= meta.total_assignments %></div>
      <div class="stat-desc">T·ªïng s·ªë b√†i t·∫≠p</div>
    </div>

    <div class="stat-card">
      <h3>Quiz</h3>
      <div class="stat-value"><%= meta.total_quizzes %></div>
      <div class="stat-desc">T·ªïng s·ªë b√†i ki·ªÉm tra</div>
    </div>

    <div class="stat-card">
      <h3>S·ªë h·ªçc vi√™n</h3>
      <div class="stat-value"><%= students.length %></div>
      <div class="stat-desc">ƒêang tham gia kh√≥a h·ªçc</div>
    </div>
  </div>

  <!-- STUDENT LIST TABLE -->
  <div class="student-panel">
    <h2 class="section-title">Danh s√°ch h·ªçc vi√™n</h2>

    <table class="modern-table wide">
      <thead>
        <tr>
          <th>H·ªçc vi√™n</th>
          <th>Ti·∫øn ƒë·ªô</th>
          <th>B√†i h·ªçc</th>
          <th>B√†i t·∫≠p</th>
          <th>Quiz</th>
          <th>Nh·∫Øc nh·ªü</th>
        </tr>
      </thead>

      <tbody>
        <% students.forEach(s => { %>
        <tr>
          <!-- USER INFO -->
          <td class="u-info">
            <img src="<%= s.avatar || '/images/default-avatar.png' %>" class="avatar">
            <div>
              <b><%= s.full_name %></b><br>
              <span class="email"><%= s.email %></span>
            </div>
          </td>

          <!-- PROGRESS -->
          <td>
            <div class="progress-line">
              <div class="p-number"><%= s.progress_percent %>%</div>
              <div class="p-bar">
                <div class="p-fill" style="width:<%= s.progress_percent %>%"></div>
              </div>
            </div>
          </td>

          <!-- LESSONS -->
          <td>
            <%= s.lessons_done %> / <%= meta.total_lessons %>
          </td>

          <!-- ASSIGNMENTS -->
          <td><%= s.assignments_done %></td>

          <!-- QUIZZES -->
          <td><%= s.quizzes_done %></td>

          <!-- REMIND -->
          <td>
            <button class="btn-remind" onclick="notify(<%= s.id %>)">
              üîî G·ª≠i
            </button>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

</main>

<script>
function notify(studentId) {
  if (!confirm("G·ª≠i nh·∫Øc nh·ªü h·ªçc vi√™n n√†y?")) return;

  fetch(`/instructor/courses/<%= courseId %>/students/${studentId}/notify`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({})
  })
    .then(r => r.json())
    .then(d => {
      if (d.success) alert("ƒê√£ g·ª≠i nh·∫Øc nh·ªü!");
    });
}
</script>

<%- include("../partials/db-footer") %>
