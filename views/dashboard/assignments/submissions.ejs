<%- include("../../partials/db-header") %>
<link rel="stylesheet" href="/assets/css/assignments-submissions.css">
<main class="dash-main modern-ui main-offset">

  <!-- TOPBAR -->
  <div class="course-topbar">
    <div class="left">
      <h1 class="page-title">Bài nộp – <%= assignment.title %></h1>
      <p class="page-sub">
        Danh sách bài làm của học viên cho bài tập này.
      </p>
    </div>

    <a href="/dashboard/assignments?course_id=<%= assignment.course_id %>" 
       class="btn-reset" style="text-decoration:none;">
      <i class="bi bi-arrow-left"></i>
      Quay lại danh sách
    </a>
  </div>

  <!-- WRAPPER -->
  <div class="course-table-wrapper modern-card">

    <!-- HEADER BAR -->
    <div class="table-header-row">
      <div class="table-title">
        Danh sách bài nộp
      </div>
    </div>

    <!-- TABLE -->
    <table class="modern-table">
      <thead>
        <tr>
          <th>Học viên</th>
          <th>Email</th>
          <th>File</th>
          <th>Nộp lúc</th>
          <th>Điểm</th>
          <th class="col-actions">Chấm bài</th>
        </tr>
      </thead>

      <tbody>
        <% if (!submissions || submissions.length === 0) { %>
          <tr>
            <td colspan="6" class="empty-row">
              Chưa có học viên nào nộp bài.
            </td>
          </tr>
        <% } else { %>
          <% submissions.forEach(s => { %>
            <tr class="row-item">

              <!-- STUDENT NAME -->
              <td>
                <div class="course-main">
                  <div class="course-meta">
                    <div class="c-title"><%= s.student_name %></div>
                    <div class="c-date">
                      ID học viên: <%= s.student_id %>
                    </div>
                  </div>
                </div>
              </td>

              <!-- EMAIL -->
              <td><%= s.student_email %></td>

              <!-- FILE -->
              <td>
                <a href="<%= s.file_url %>" 
                   class="badge badge-blue" 
                   download style="text-decoration:none;">
                  <i class="bi bi-file-earmark-arrow-down"></i>
                  Tải bài
                </a>
              </td>

              <!-- TIME -->
              <td>
                <span class="badge badge-purple">
                  <i class="bi bi-clock-history"></i>
                  <%= new Date(s.submitted_at).toLocaleString("vi-VN") %>
                </span>
              </td>

              <!-- SCORE -->
              <td>
                <% if (s.score != null) { %>
                  <span class="badge badge-green">
                    <i class="bi bi-check-circle"></i>
                    <%= s.score %> / <%= assignment.max_score %>
                  </span>
                <% } else { %>
                  <span class="badge badge-yellow">
                    <i class="bi bi-hourglass-split"></i>
                    Chưa chấm
                  </span>
                <% } %>
              </td>

              <!-- GRADE FORM -->
              <td class="col-actions">
                <form action="/dashboard/assignments/submissions/<%= s.id %>/grade" 
                      method="POST"
                      class="grade-form">

                  <input type="number"
                         name="score"
                         class="form-control form-control-sm"
                         placeholder="Điểm"
                         value="<%= s.score || '' %>"
                         min="0"
                         max="<%= assignment.max_score %>"
                         required>

                  <input type="text"
                         name="feedback"
                         class="form-control form-control-sm"
                         placeholder="Nhận xét"
                         value="<%= s.feedback || '' %>">

                  <button class="btn-save" type="submit">
                    <i class="bi bi-save"></i> Lưu
                  </button>
                </form>
              </td>

            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>

    <!-- FOOTER -->
    <div class="table-footer">
      <div class="table-info">
        Có tất cả <strong><%= submissions.length %></strong> bài nộp.
      </div>
      <div class="pager"></div>
    </div>

  </div>

</main>

<%- include("../../partials/db-footer") %>

