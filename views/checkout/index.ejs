<%- include("../partials/header") %>
<link rel="stylesheet" href="/assets/css/cart-checkout.css">

<!-- Hero banner đẹp, tách khỏi header -->
<section class="checkout-hero-banner">
  <div class="overlay"></div>
  <div class="container text-center">
    <h1 class="hero-title">Thanh toán</h1>
    <p class="hero-sub">Xác nhận đơn hàng và hoàn tất thanh toán.</p>
  </div>
</section>

<section class="page-hero">
  <div class="container">
    <div class="steps">
      <div class="step done"><span>1</span><label>Giỏ hàng</label></div>
      <div class="step active"><span>2</span><label>Thanh toán</label></div>
      <div class="step"><span>3</span><label>Hoàn tất</label></div>
    </div>
  </div>
</section>


<section class="checkout-section">
  <div class="container grid-2">
    <!-- Left: Details -->
    <div class="checkout-left">
      <div class="glass block">
        <h5 class="block-title">Thông tin người mua</h5>
        <div class="buyer">
          <div class="avatar-sm"><i class="bi bi-person"></i></div>
          <div>
<div class="name"><%= (user?.full_name || 'Người dùng') %></div>
<div class="muted"><%= (user?.email || '—') %></div>

          </div>
        </div>
      </div>

      <div class="glass block">
        <h5 class="block-title">Phương thức thanh toán</h5>
        <div class="pay-options">
<label class="pay-option">
  <input type="radio" name="pay" value="card" checked>
  <div class="icon"><i class="bi bi-credit-card"></i></div>
  <div>
    <div class="pay-name">Thanh toán demo</div>
  </div>
</label>

<label class="pay-option">
  <input type="radio" name="pay" value="vnpay">
  <div class="icon"><img src="/assets/images/logos/vnpay.png" style="width:38px"></div>
  <div>
    <div class="pay-name">Thanh toán VNPay</div>
  </div>
</label>

<label class="pay-option">
  <input type="radio" name="pay" value="momo">
  <div class="icon"><img src="/assets/images/logos/momo.png" style="width:38px"></div>
  <div>
    <div class="pay-name">Thanh toán MoMo</div>
  </div>
</label>

        </div>
      </div>

      <div class="glass block">
        <h5 class="block-title">Khóa học trong đơn</h5>
        <ul class="mini-list">
          <% items.forEach(item => { %>
            <li>
              <div class="mini-thumb">
                <img src="<%= item.thumbnail || '/assets/images/default-course.jpg' %>">
              </div>
              <div class="mini-info">
                <div class="mini-title"><%= item.title %></div>
                <div class="muted">Truy cập trọn đời • Học mọi lúc</div>
              </div>
              <div class="mini-price"><%= Number(item.price||0).toLocaleString() %> VND</div>
            </li>
          <% }) %>
        </ul>
      </div>
    </div>

    <!-- Right: Summary -->
    <aside class="summary glass sticky">
      <h5 class="summary-title">Tổng kết</h5>

      <div class="summary-line">
        <span>Tạm tính</span><span><%= items.reduce((s,i)=> s+Number(i.price||0),0).toLocaleString() %> VND</span>
      </div>
      <div class="summary-line">
        <span>Ưu đãi</span><span>- 0 VND</span>
      </div>
      <div class="summary-total">
        <span>Tổng cộng</span><span><%= Number(total||0).toLocaleString() %> VND</span>
      </div>

      <form action="/checkout/pay" method="post" class="mt-3">
  <input type="hidden" name="payment_method" id="payment_method" value="card">
  <button class="btn btn-success w-100 rounded-pill">Xác nhận thanh toán</button>
</form>




      <div class="secure-note">
        <i class="bi bi-shield-check"></i> Sau khi thanh toán, khóa học sẽ tự động được thêm vào “Khóa học của tôi”.
      </div>
    </aside>
  </div>
</section>
<script>
  document.querySelectorAll('input[name="pay"]').forEach(radio => {
    radio.addEventListener('change', e => {
      document.getElementById('payment_method').value = e.target.value;
    });
  });
</script>
<%- include("../partials/footer") %>
